"use strict";window.easycrm||(window.easycrm={},window.easycrm.scriptsLoaded=!1),window.easycrm.scriptsLoaded||(window.easycrm.init=function(){window.easycrm.load_list_script()},window.easycrm.load_list_script=function(){if(!window.easycrm.scriptsLoaded){let a=void 0,e=void 0;for(a in window.easycrm)for(e in window.easycrm[a].init&&window.easycrm[a].init(),window.easycrm[a])window.easycrm[a]&&window.easycrm[a][e]&&window.easycrm[a][e].init&&window.easycrm[a][e].init();window.easycrm.scriptsLoaded=!0}},window.easycrm.refresh=function(){let a=void 0,e=void 0;for(a in window.easycrm)for(e in window.easycrm[a].refresh&&window.easycrm[a].refresh(),window.easycrm[a])window.easycrm[a]&&window.easycrm[a][e]&&window.easycrm[a][e].refresh&&window.easycrm[a][e].refresh()},$(document).ready(window.easycrm.init)),window.easycrm.address={},window.easycrm.address.init=function(){window.easycrm.address.event()},window.easycrm.address.event=function(){$(document).on("click",'[name="favorite_address"]',window.easycrm.address.toggleAddressFavorite)},window.easycrm.address.toggleAddressFavorite=function(){var a=$(this).attr("value");let e=$(this);var i=window.saturne.toolbox.getToken();let n="?";document.URL.match(/\?/)&&(n="&"),$.ajax({url:document.URL+n+"action=toggle_favorite&favorite_id="+a+"&token="+i,type:"POST",processData:!1,contentType:!1,success:function(){var a=$(".fas.fa-star");e.hasClass("far")&&(e.removeClass("far"),e.addClass("fas")),a.removeClass("fas").addClass("far")},error:function(){}})},window.easycrm.quickcreation={},window.easycrm.quickcreation.canvas,window.easycrm.quickcreation.rotation=0,window.easycrm.quickcreation.img,window.easycrm.quickcreation.init=function(){window.easycrm.quickcreation.event()},window.easycrm.quickcreation.event=function(){$(document).on("change","#upload-image",window.easycrm.quickcreation.uploadImage),$(document).on("click",".image-rotate-left",function(){window.easycrm.quickcreation.rotateImage(-90)}),$(document).on("click",".image-rotate-right",function(){window.easycrm.quickcreation.rotateImage(90)}),$(document).on("click",".image-undo",window.easycrm.quickcreation.undoLastDraw),$(document).on("click",".image-erase",window.easycrm.quickcreation.clearCanvas),$(document).on("click",".image-validate",window.easycrm.quickcreation.createImg)},window.easycrm.quickcreation.uploadImage=function(){var a;this.files&&this.files[0]&&((a=new FileReader).onload=function(a){$(document).find(".modal-upload-image").addClass("modal-active"),window.easycrm.quickcreation.drawImageOnCanvas(a)},a.readAsDataURL(this.files[0]))},window.easycrm.quickcreation.rotateImage=function(a){window.easycrm.quickcreation.rotation+=a,$("#canvas").css("transform","rotate("+window.easycrm.quickcreation.rotation+"deg)")},window.easycrm.quickcreation.undoLastDraw=function(){var a=$(this).closest(".modal-upload-image").find("canvas"),e=a[0].signaturePad.toData();e&&(e.pop(),a[0].signaturePad.fromData(e),window.easycrm.quickcreation.drawImageOnCanvas(window.easycrm.quickcreation.img))},window.easycrm.quickcreation.clearCanvas=function(){$(this).closest(".modal-upload-image").find("canvas")[0].signaturePad.clear(),window.easycrm.quickcreation.drawImageOnCanvas(window.easycrm.quickcreation.img)},window.easycrm.quickcreation.drawImageOnCanvas=function(a){var e=Math.max(window.devicePixelRatio||1,1);window.easycrm.quickcreation.canvas=document.querySelector("#modal-upload-image0 canvas"),window.easycrm.quickcreation.canvas.signaturePad=new SignaturePad(window.easycrm.quickcreation.canvas,{penColor:"rgb(175, 175, 175)"}),window.easycrm.quickcreation.canvas.width=200*e,window.easycrm.quickcreation.canvas.height=200*e,window.easycrm.quickcreation.canvas.getContext("2d");let i=window.easycrm.quickcreation.canvas.getContext("2d");window.easycrm.quickcreation.canvas.signaturePad.clear();var n=new Image;n.src=a.target.result,window.easycrm.quickcreation.img=a,n.onload=function(){i.drawImage(n,0,0,window.easycrm.quickcreation.canvas.width,window.easycrm.quickcreation.canvas.height)},window.easycrm.quickcreation.rotation=0},window.easycrm.quickcreation.createImg=function(){var a=$(this).closest(".wpeo-modal").find("canvas")[0].toDataURL("image/png",.5),e=window.saturne.toolbox.getToken(),i=window.saturne.toolbox.getQuerySeparator(document.URL),i=document.URL+i+"action=add_img&token="+e;$.ajax({url:i,type:"POST",processData:!1,contentType:"application/octet-stream",data:JSON.stringify({img:a}),success:function(a){$(".wpeo-modal").removeClass("modal-active"),$(".project-container .linked-medias-list").replaceWith($(a).find(".project-container .linked-medias-list"))},error:function(){}})};